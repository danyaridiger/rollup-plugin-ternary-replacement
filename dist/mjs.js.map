{"version":3,"file":"mjs.js","sources":["../modules/jsx-parser.js","../modules/parser-options.js","../transforms/convert-non-null-merge.js","../transforms/convert-merge-assignment.js","../transforms/convert-logical-multiply-assignment.js","../modules/RollupPluginTernaryReplacementError.js","../index.js"],"sourcesContent":["import jsx from \"acorn-jsx\";\r\nimport * as acorn from \"acorn\";\r\n\r\n/**\r\n * Code parser extended by jsx plugin\r\n * @constant {acorn.Parser} JSXParser\r\n */\r\nexport default acorn.Parser.extend(jsx());","/**\r\n * @typedef {object} Plugins\r\n * @property {boolean} jsx - jsx syntax flag\r\n */\r\n\r\n/**\r\n * @type {object}\r\n * @property {boolean} allowReserved - reserved keyword restriction flag\r\n * @property {boolean} allowImportExportEverywhere - esm operator restriction flag\r\n * @property {boolean} allowHashBang - hashbang comments restriction flag\r\n * @property {number} ecmaVersion - ECMAScript version\r\n * @property {string} sourceType - source program type\r\n * @property {Plugins} plugins - plugin options\r\n */\r\nexport default {\r\n  allowReserved: true,\r\n  allowImportExportEverywhere: true,\r\n  allowHashBang: true,\r\n  ecmaVersion: 13,\r\n  sourceType: 'module',\r\n  plugins: {\r\n    jsx: true,\r\n  },\r\n};","import escodegen from \"escodegen\";\r\nimport JSXParser from \"../modules/jsx-parser\";\r\nimport parserOptions from \"../modules/parser-options\";\r\n\r\n/**\r\n * Transforms given code replacing non-null \r\n * merge operators with ternary operators\r\n * @function\r\n * @param {Node} fragment - code fragment to search in\r\n * @returns {string} code\r\n */\r\nexport default function convertNonNullMerge(fragment) {\r\n  const identifier = fragment.left.raw || fragment.left.name;\r\n  const finalString = `${identifier} !== null && ${identifier} !== undefined`;\r\n  const fragmentToReplace = JSXParser.parse(finalString, parserOptions);\r\n  const newFragment = escodegen.generate({\r\n    type: \"ConditionalExpression\",\r\n    test: fragmentToReplace,\r\n    consequent: fragment.left,\r\n    alternate: fragment.right,\r\n  });\r\n  \r\n  return newFragment.replace(\";\", \"\");\r\n}","import escodegen from \"escodegen\";\r\nimport JSXParser from \"../modules/jsx-parser\";\r\nimport parserOptions from \"../modules/parser-options\";\r\n\r\n/**\r\n * Transforms given code replacing non-null \r\n * merge assignments with ternary operators\r\n * @function\r\n * @param {Node} fragment - code fragment to search in\r\n * @returns {string} code\r\n */\r\nexport default function convertMergeAssignment(fragment) {\r\n  const identifier = fragment.left.raw || fragment.left.name;\r\n  const appropriator = fragment.right.raw || fragment.right.name;\r\n  const finalString = `\r\n    ${identifier} !== null && ${identifier} !== undefined \r\n     ? ${identifier} = ${appropriator} \r\n     : false`;\r\n\r\n  const fragmentToReplace = JSXParser.parse(finalString, parserOptions);\r\n  const expression = fragmentToReplace.body[0].expression;\r\n  const newFragment = escodegen.generate(expression);\r\n\r\n  return newFragment;\r\n}","import escodegen from \"escodegen\";\r\nimport JSXParser from \"../modules/jsx-parser\";\r\nimport parserOptions from \"../modules/parser-options\";\r\n\r\n/**\r\n * Transforms given code replacing logical \r\n * assignments with ternary operators\r\n * @function\r\n * @param {Node} fragment - code fragment to search in\r\n * @param {boolean} [additionAssignment=false] - addition assignment operator flag\r\n * @returns {string} code\r\n */\r\nexport default function convertLogicalAssignment(fragment, additionAssignment = false) {\r\n  const identifier = fragment.left.raw || fragment.left.name;\r\n  const appropriator = fragment.right.raw || fragment.right.name;\r\n\r\n  let finalString = `${identifier} ? ${identifier} = ${appropriator} : false`;\r\n\r\n  finalString = additionAssignment ? finalString : `!${finalString}`;\r\n\r\n  const fragmentToReplace = JSXParser.parse(finalString, parserOptions);\r\n  const expression = fragmentToReplace.body[0].expression;\r\n  const newFragment = escodegen.generate(expression);\r\n\r\n  return newFragment;\r\n}","/**\r\n * Local Error instance\r\n * @class\r\n * @extends Error\r\n */\r\nexport default class RollupPluginTernaryReplacementError extends Error {}","import walk from \"estree-visitor\";\r\nimport MagicString from \"magic-string\";\r\nimport { extname } from \"path\";\r\nimport { createFilter } from \"@rollup/pluginutils\";\r\nimport JSXParser from \"./modules/jsx-parser.js\";\r\nimport parserOptions from \"./modules/parser-options\";\r\nimport convertNonNullMerge from \"./transforms/convert-non-null-merge.js\";\r\nimport convertMergeAssignment from \"./transforms/convert-merge-assignment.js\";\r\nimport convertLogicalMultiplyAssignment from \"./transforms/convert-logical-multiply-assignment.js\";\r\nimport RollupPlaginTernaryReplacementError from \"./modules/RollupPluginTernaryReplacementError.js\";\r\n\r\n/**\r\n * @typedef {object} Options\r\n * @property {Array} [exclude] - list of file/directory patterns that should be excluded from plugin launch\r\n * @property {Array} [excludeExtentions] - list of file extensions that should be excluded from plugin launch\r\n * @property {boolean} [includeSourceMap] - enable source map flag\r\n * @property {boolean} [nonNullMergesOnly] - transform assignments disable flag\r\n * @property {boolean} [assignmentsOnly] - transform non-null merges disable flag\r\n */\r\n\r\n/**\r\n * @typedef {object} Transform\r\n * @method transform - transforms given code fragment from each file\r\n */\r\n\r\n/**\r\n * @typedef {object} TransformResult\r\n * @property {string} code - transformed code\r\n * @property {SourceMap} map - transformed source map\r\n */\r\n\r\n/**\r\n * Transforms source code according to options requirements\r\n * @author Ridiger Daniil Dmitrievich, 2023\r\n * @function\r\n * @param {Options} [options = {}] - plugin options\r\n * @returns {Transform} transformation\r\n * @version 0.0.2\r\n */\r\nmodule.exports = function rollupPluginTernaryReplacement(options = {}) {\r\n  const exclude = options.exclude ? options.exclude.map((path) => new RegExp(path, \"i\")) : [];\r\n  const include = createFilter([], exclude);\r\n  const excludeExtentions = options.excludeExtentions || [];\r\n  const includeSourceMap = options.includeSourceMap;\r\n  const nonNullMergesOnly = options.nonNullMergesOnly;\r\n  const assignmentsOnly = options.assignmentsOnly;\r\n  \r\n  return {\r\n    /**\r\n     * Transforms given code fragment from each file\r\n     * @method\r\n     * @param {string} code - code from each file\r\n     * @param {string} path - path to each file\r\n     * @returns {TransformResult} code\r\n     */\r\n    transform: (code, path) => {\r\n      if (excludeExtentions.includes(extname(path).slice(1)) || !include(path)) {\r\n        return null;\r\n      }\r\n\r\n      let node;\r\n\r\n      try {\r\n        node = JSXParser.parse(code, parserOptions);\r\n      } catch(error) {\r\n        throw new RollupPlaginTernaryReplacementError(`${error.message} â€” thrown in ${path}`);\r\n      }\r\n\r\n      const magicString = new MagicString(code);\r\n\r\n      walk(node, {\r\n        /**\r\n         * Replaces given nodes with new ones if necessary\r\n         * @method\r\n         * @param {Node} fragment \r\n         * @returns {MagicString} node\r\n         */\r\n        enter: (fragment) => {\r\n          if (fragment.operator && fragment.operator === \"??\" && !assignmentsOnly) {\r\n            const newFragment = convertNonNullMerge(fragment);\r\n\r\n            magicString.overwrite(fragment.start, fragment.end, newFragment);\r\n          }\r\n\r\n          if (fragment.operator && fragment.operator === \"&&=\" && !nonNullMergesOnly) {\r\n            const newFragment = convertLogicalMultiplyAssignment(fragment);\r\n\r\n            magicString.overwrite(fragment.start, fragment.end, newFragment);\r\n          }\r\n\r\n          if (fragment.operator && fragment.operator === \"||=\" && !nonNullMergesOnly) {\r\n            const newFragment = convertLogicalMultiplyAssignment(fragment, true);\r\n\r\n            magicString.overwrite(fragment.start, fragment.end, newFragment);\r\n          }\r\n\r\n          if (fragment.operator && fragment.operator === \"??=\" && !nonNullMergesOnly) {\r\n            const newFragment = convertMergeAssignment(fragment);\r\n\r\n            magicString.overwrite(fragment.start, fragment.end, newFragment);\r\n          }\r\n\r\n          return magicString;\r\n        },\r\n      });\r\n\r\n      return {\r\n        code: magicString.toString(),\r\n        map: includeSourceMap ? magicString.generateMap() : null,\r\n      };\r\n    },\r\n  }\r\n}"],"names":["acorn","Parser","extend","jsx","allowReserved","allowImportExportEverywhere","allowHashBang","ecmaVersion","sourceType","plugins","convertNonNullMerge","fragment","identifier","left","raw","name","finalString","fragmentToReplace","JSXParser","parse","parserOptions","newFragment","escodegen","generate","type","test","consequent","alternate","right","replace","convertMergeAssignment","appropriator","expression","body","convertLogicalAssignment","additionAssignment","RollupPluginTernaryReplacementError","Error","module","exports","rollupPluginTernaryReplacement","options","exclude","map","path","RegExp","include","createFilter","excludeExtentions","includeSourceMap","nonNullMergesOnly","assignmentsOnly","transform","code","includes","extname","slice","node","error","RollupPlaginTernaryReplacementError","message","magicString","MagicString","walk","enter","operator","overwrite","start","end","convertLogicalMultiplyAssignment","toString","generateMap"],"mappings":"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"}